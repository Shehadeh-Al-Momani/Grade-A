{"ast":null,"code":"import { useState, useEffect } from 'react';\nimport axios from \"axios\";\nimport io from 'socket.io-client';\nimport jwt_decode from 'jwt-decode';\nlet token = localStorage.getItem('token');\nconst decoded = jwt_decode(token);\nlet socket;\n\nconst useChat = (insID, stuId) => {\n  const [messages, setMessages] = useState([]); // Sent and received messages\n\n  const [oneMessage, setMessage] = useState([]);\n  useEffect(() => {\n    socket = io(`http://localhost:5000/`, {\n      query: {\n        otherUser,\n        cuurentUser\n      }\n    }); // Creates a WebSocket connection\n\n    axios.get(`http://localhost:5000/${cuurentUser}/${otherUser}`).then(res => {\n      setMessages(res.data);\n    }); // socket.emit('newMessage', { name, room });\n    // Listens for incoming messages\n\n    socket.on('newMessage', message => {\n      const incomingMessage = { ...message,\n        sender: message.senderId === socket.id ? 1 : 0\n      };\n      setMessage(incomingMessage);\n      console.log('message :', message);\n      axios.post('http://localhost:5000/messeges', incomingMessage).then(res => {\n        messages.push(incomingMessage);\n        setMessages(messages);\n      }).catch(err => {\n        console.log('ERR: ', err);\n      });\n    });\n    return () => {\n      socket.disconnect();\n    }; // Destroys the socket reference when the connection is closed\n  }, [oneMessage]); // Sends a message to the server that forwards it to all users in the same room\n\n  const sendMessage = (messageBody, id) => {\n    socket.emit('newMessage', {\n      message: messageBody,\n      senderId: socket.id,\n      insID: decoded.role_id === 2 ? cuurentUser : Number(otherUser),\n      stuID: decoded.role_id === 3 ? cuurentUser : Number(otherUser),\n      sender_id: id\n    });\n  };\n\n  return {\n    messages,\n    sendMessage\n  };\n};\n\nexport default useChat;","map":{"version":3,"sources":["E:/JCA/Projects/Project-5/Grade-A/Front-End/src/components/useChat.js"],"names":["useState","useEffect","axios","io","jwt_decode","token","localStorage","getItem","decoded","socket","useChat","insID","stuId","messages","setMessages","oneMessage","setMessage","query","otherUser","cuurentUser","get","then","res","data","on","message","incomingMessage","sender","senderId","id","console","log","post","push","catch","err","disconnect","sendMessage","messageBody","emit","role_id","Number","stuID","sender_id"],"mappings":"AAAA,SAASA,QAAT,EAAmBC,SAAnB,QAAoC,OAApC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,EAAP,MAAe,kBAAf;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,IAAIC,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAZ;AACA,MAAMC,OAAO,GAAGJ,UAAU,CAACC,KAAD,CAA1B;AACA,IAAII,MAAJ;;AAEA,MAAMC,OAAO,GAAG,CAACC,KAAD,EAAQC,KAAR,KAAkB;AAChC,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0Bd,QAAQ,CAAC,EAAD,CAAxC,CADgC,CACc;;AAC9C,QAAM,CAACe,UAAD,EAAaC,UAAb,IAA2BhB,QAAQ,CAAC,EAAD,CAAzC;AACAC,EAAAA,SAAS,CAAC,MAAM;AACdQ,IAAAA,MAAM,GAAGN,EAAE,CAAE,wBAAF,EAA2B;AAAEc,MAAAA,KAAK,EAAE;AAAEC,QAAAA,SAAF;AAAaC,QAAAA;AAAb;AAAT,KAA3B,CAAX,CADc,CACgE;;AAC9EjB,IAAAA,KAAK,CAACkB,GAAN,CAAW,yBAAwBD,WAAY,IAAGD,SAAU,EAA5D,EAA+DG,IAA/D,CAAqEC,GAAD,IAAS;AAAER,MAAAA,WAAW,CAACQ,GAAG,CAACC,IAAL,CAAX;AAAwB,KAAvG,EAFc,CAGd;AAEA;;AACAd,IAAAA,MAAM,CAACe,EAAP,CAAU,YAAV,EAAyBC,OAAD,IAAa;AACnC,YAAMC,eAAe,GAAG,EAAE,GAAGD,OAAL;AAAcE,QAAAA,MAAM,EAAGF,OAAO,CAACG,QAAR,KAAqBnB,MAAM,CAACoB,EAA7B,GAAmC,CAAnC,GAAuC;AAA7D,OAAxB;AACAb,MAAAA,UAAU,CAACU,eAAD,CAAV;AACNI,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBN,OAAzB;AACMvB,MAAAA,KAAK,CAAC8B,IAAN,CAAW,gCAAX,EAA6CN,eAA7C,EACGL,IADH,CACSC,GAAD,IAAS;AACbT,QAAAA,QAAQ,CAACoB,IAAT,CAAcP,eAAd;AACAZ,QAAAA,WAAW,CAACD,QAAD,CAAX;AACD,OAJH,EAKGqB,KALH,CAKUC,GAAD,IAAS;AAAEL,QAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBI,GAArB;AAA2B,OAL/C;AAMD,KAVD;AAYA,WAAO,MAAM;AAAE1B,MAAAA,MAAM,CAAC2B,UAAP;AAAqB,KAApC,CAlBc,CAkBwB;AACvC,GAnBQ,EAmBN,CAACrB,UAAD,CAnBM,CAAT,CAHgC,CAyB9B;;AACA,QAAMsB,WAAW,GAAG,CAACC,WAAD,EAAcT,EAAd,KAAqB;AACvCpB,IAAAA,MAAM,CAAC8B,IAAP,CAAY,YAAZ,EAA0B;AACxBd,MAAAA,OAAO,EAAEa,WADe;AAExBV,MAAAA,QAAQ,EAAEnB,MAAM,CAACoB,EAFO;AAGxBlB,MAAAA,KAAK,EAAGH,OAAO,CAACgC,OAAR,KAAoB,CAArB,GAA0BrB,WAA1B,GAAwCsB,MAAM,CAACvB,SAAD,CAH7B;AAIxBwB,MAAAA,KAAK,EAAGlC,OAAO,CAACgC,OAAR,KAAoB,CAArB,GAA0BrB,WAA1B,GAAwCsB,MAAM,CAACvB,SAAD,CAJ7B;AAKxByB,MAAAA,SAAS,EAAEd;AALa,KAA1B;AAOD,GARD;;AAUF,SAAO;AAAEhB,IAAAA,QAAF;AAAYwB,IAAAA;AAAZ,GAAP;AACD,CArCD;;AAuCA,eAAe3B,OAAf","sourcesContent":["import { useState, useEffect } from 'react';\r\nimport axios from \"axios\";\r\nimport io from 'socket.io-client';\r\nimport jwt_decode from 'jwt-decode';\r\nlet token = localStorage.getItem('token');\r\nconst decoded = jwt_decode(token);\r\nlet socket;\r\n\r\nconst useChat = (insID, stuId) => {\r\n  const [messages, setMessages] = useState([]); // Sent and received messages\r\n  const [oneMessage, setMessage] = useState([]);\r\n  useEffect(() => {\r\n    socket = io(`http://localhost:5000/`, { query: { otherUser, cuurentUser } }); // Creates a WebSocket connection\r\n    axios.get(`http://localhost:5000/${cuurentUser}/${otherUser}`).then((res) => { setMessages(res.data); });\r\n    // socket.emit('newMessage', { name, room });\r\n\r\n    // Listens for incoming messages\r\n    socket.on('newMessage', (message) => {\r\n      const incomingMessage = { ...message, sender: (message.senderId === socket.id) ? 1 : 0 };\r\n      setMessage(incomingMessage);\r\nconsole.log('message :', message)\r\n      axios.post('http://localhost:5000/messeges', incomingMessage)\r\n        .then((res) => {\r\n          messages.push(incomingMessage)\r\n          setMessages(messages);\r\n        })\r\n        .catch((err) => { console.log('ERR: ', err) })\r\n    });\r\n\r\n    return () => { socket.disconnect() }; // Destroys the socket reference when the connection is closed\r\n  }, [oneMessage])\r\n\r\n\r\n    // Sends a message to the server that forwards it to all users in the same room\r\n    const sendMessage = (messageBody, id) => {\r\n      socket.emit('newMessage', {\r\n        message: messageBody,\r\n        senderId: socket.id,\r\n        insID: (decoded.role_id === 2) ? cuurentUser : Number(otherUser),\r\n        stuID: (decoded.role_id === 3) ? cuurentUser : Number(otherUser),\r\n        sender_id: id\r\n      });\r\n    };\r\n\r\n  return { messages, sendMessage };\r\n};\r\n\r\nexport default useChat;\r\n"]},"metadata":{},"sourceType":"module"}