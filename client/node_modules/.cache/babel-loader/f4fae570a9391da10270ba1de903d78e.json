{"ast":null,"code":"import { useState, useEffect } from 'react';\nimport axios from \"axios\";\nimport io from 'socket.io-client';\nimport jwt_decode from 'jwt-decode';\nlet token = localStorage.getItem('token');\nconst decoded = jwt_decode(token);\nlet socket;\n\nconst useChat = (newMessage, stuId, insID, cuurentUser) => {\n  const [messages, setMessages] = useState([]); // Sent and received messages\n\n  const [oneMessage, setMessage] = useState([]);\n  useEffect(() => {\n    axios.get(`http://localhost:5000/${stuId}/${insID}`).then(res => {\n      setMessages(res.data);\n    });\n  }, []);\n  useEffect(() => {\n    socket = io(`http://localhost:5000/`, {\n      query: {\n        insID,\n        stuId\n      }\n    }); // Creates a WebSocket connection\n    // Listens for incoming messages\n\n    socket.on('newMessage', message => {\n      console.log('message :', message);\n      setMessage(message);\n      axios.post('http://localhost:5000/messeges', message).then(res => {\n        messages.push(message);\n        setMessages(messages => [...messages, message]);\n      }).catch(err => {\n        console.log('ERR: ', err);\n      });\n    });\n    return () => {\n      socket.disconnect();\n    }; // Destroys the socket reference when the connection is closed\n  }, [oneMessage]); // Sends a message to the server that forwards it to all users in the same room\n\n  const sendMessage = (newMessage, stuId, insID, cuurentUser, e) => {\n    socket.emit('newMessage', {\n      message: newMessage,\n      insID: insID,\n      stuID: stuId,\n      sender_id: cuurentUser,\n      sender: stuId === cuurentUser ? 1 : 0,\n      z: socket.id\n    });\n  };\n\n  return {\n    messages,\n    sendMessage\n  };\n};\n\nexport default useChat;","map":{"version":3,"sources":["E:/JCA/Projects/Project-5/Grade-A/Front-End/src/components/useChat.js"],"names":["useState","useEffect","axios","io","jwt_decode","token","localStorage","getItem","decoded","socket","useChat","newMessage","stuId","insID","cuurentUser","messages","setMessages","oneMessage","setMessage","get","then","res","data","query","on","message","console","log","post","push","catch","err","disconnect","sendMessage","e","emit","stuID","sender_id","sender","z","id"],"mappings":"AAAA,SAASA,QAAT,EAAmBC,SAAnB,QAAoC,OAApC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,EAAP,MAAe,kBAAf;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,IAAIC,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAZ;AACA,MAAMC,OAAO,GAAGJ,UAAU,CAACC,KAAD,CAA1B;AACA,IAAII,MAAJ;;AAEA,MAAMC,OAAO,GAAG,CAACC,UAAD,EAAaC,KAAb,EAAoBC,KAApB,EAA2BC,WAA3B,KAA2C;AACzD,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BhB,QAAQ,CAAC,EAAD,CAAxC,CADyD,CACX;;AAC9C,QAAM,CAACiB,UAAD,EAAaC,UAAb,IAA2BlB,QAAQ,CAAC,EAAD,CAAzC;AAEAC,EAAAA,SAAS,CAAC,MAAM;AACdC,IAAAA,KAAK,CAACiB,GAAN,CAAW,yBAAwBP,KAAM,IAAGC,KAAM,EAAlD,EACGO,IADH,CACSC,GAAD,IAAS;AACbL,MAAAA,WAAW,CAACK,GAAG,CAACC,IAAL,CAAX;AACD,KAHH;AAID,GALQ,EAKN,EALM,CAAT;AAOArB,EAAAA,SAAS,CAAC,MAAM;AACdQ,IAAAA,MAAM,GAAGN,EAAE,CAAE,wBAAF,EAA2B;AAAEoB,MAAAA,KAAK,EAAE;AAAEV,QAAAA,KAAF;AAASD,QAAAA;AAAT;AAAT,KAA3B,CAAX,CADc,CACsD;AAEpE;;AACAH,IAAAA,MAAM,CAACe,EAAP,CAAU,YAAV,EAAyBC,OAAD,IAAa;AACnCC,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBF,OAAzB;AACAP,MAAAA,UAAU,CAACO,OAAD,CAAV;AACAvB,MAAAA,KAAK,CAAC0B,IAAN,CAAW,gCAAX,EAA6CH,OAA7C,EACGL,IADH,CACSC,GAAD,IAAS;AACbN,QAAAA,QAAQ,CAACc,IAAT,CAAcJ,OAAd;AACAT,QAAAA,WAAW,CAAED,QAAD,IAAc,CAAC,GAAGA,QAAJ,EAAcU,OAAd,CAAf,CAAX;AACD,OAJH,EAKGK,KALH,CAKUC,GAAD,IAAS;AAAEL,QAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBI,GAArB;AAA2B,OAL/C;AAMD,KATD;AAWA,WAAO,MAAM;AAAEtB,MAAAA,MAAM,CAACuB,UAAP;AAAqB,KAApC,CAfc,CAewB;AACvC,GAhBQ,EAgBN,CAACf,UAAD,CAhBM,CAAT,CAXyD,CA8BzD;;AACA,QAAMgB,WAAW,GAAG,CAACtB,UAAD,EAAaC,KAAb,EAAoBC,KAApB,EAA2BC,WAA3B,EAAuCoB,CAAvC,KAA6C;AAC/DzB,IAAAA,MAAM,CAAC0B,IAAP,CAAY,YAAZ,EAA0B;AACxBV,MAAAA,OAAO,EAAEd,UADe;AAExBE,MAAAA,KAAK,EAAEA,KAFiB;AAGxBuB,MAAAA,KAAK,EAAExB,KAHiB;AAIxByB,MAAAA,SAAS,EAAEvB,WAJa;AAKxBwB,MAAAA,MAAM,EAAG1B,KAAK,KAAKE,WAAX,GAA0B,CAA1B,GAA8B,CALd;AAMxByB,MAAAA,CAAC,EAAE9B,MAAM,CAAC+B;AANc,KAA1B;AASD,GAVD;;AAYA,SAAO;AAAEzB,IAAAA,QAAF;AAAYkB,IAAAA;AAAZ,GAAP;AACD,CA5CD;;AA8CA,eAAevB,OAAf","sourcesContent":["import { useState, useEffect } from 'react';\r\nimport axios from \"axios\";\r\nimport io from 'socket.io-client';\r\nimport jwt_decode from 'jwt-decode';\r\nlet token = localStorage.getItem('token');\r\nconst decoded = jwt_decode(token);\r\nlet socket;\r\n\r\nconst useChat = (newMessage, stuId, insID, cuurentUser) => {\r\n  const [messages, setMessages] = useState([]); // Sent and received messages\r\n  const [oneMessage, setMessage] = useState([]);\r\n\r\n  useEffect(() => {\r\n    axios.get(`http://localhost:5000/${stuId}/${insID}`)\r\n      .then((res) => {\r\n        setMessages(res.data);\r\n      });\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    socket = io(`http://localhost:5000/`, { query: { insID, stuId } }); // Creates a WebSocket connection\r\n\r\n    // Listens for incoming messages\r\n    socket.on('newMessage', (message) => {\r\n      console.log('message :', message)\r\n      setMessage(message);\r\n      axios.post('http://localhost:5000/messeges', message)\r\n        .then((res) => {\r\n          messages.push(message)\r\n          setMessages((messages) => [...messages, message]);\r\n        })\r\n        .catch((err) => { console.log('ERR: ', err) })\r\n    });\r\n\r\n    return () => { socket.disconnect() }; // Destroys the socket reference when the connection is closed\r\n  }, [oneMessage])\r\n\r\n\r\n  // Sends a message to the server that forwards it to all users in the same room\r\n  const sendMessage = (newMessage, stuId, insID, cuurentUser,e) => {\r\n    socket.emit('newMessage', {\r\n      message: newMessage,\r\n      insID: insID,\r\n      stuID: stuId,\r\n      sender_id: cuurentUser,\r\n      sender: (stuId === cuurentUser) ? 1 : 0,\r\n      z: socket.id\r\n    }\r\n    );\r\n  };\r\n\r\n  return { messages, sendMessage };\r\n};\r\n\r\nexport default useChat;\r\n"]},"metadata":{},"sourceType":"module"}